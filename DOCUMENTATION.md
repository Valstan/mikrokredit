# üìñ –ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 09.10.2025  
**–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üéØ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–ú–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏](#–º–æ–¥—É–ª–∏-–∏-—Ñ—É–Ω–∫—Ü–∏–∏)
4. [Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
5. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–∏—Å—Ç–µ–º–æ–π)
6. [Troubleshooting](#troubleshooting)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ:

```
URL:     http://73269587c9af.vps.myjino.ru/
–ü–∞—Ä–æ–ª—å:  [—Å–º. .env —Ñ–∞–π–ª]
```

**–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ URL
2. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (3 –ø–æ–ø—ã—Ç–∫–∏)
3. –£–≤–∏–¥–∏—Ç–µ Dashboard —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

**–î–æ–±–∞–≤–∏—Ç—å –∑–∞–π–º:**
- Dashboard ‚Üí "üí≥ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–π–º"
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
- –î–æ–±–∞–≤—å—Ç–µ –≥—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É:**
- Dashboard ‚Üí "‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –∏ —Å—Ä–æ–∫
- –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏
- –ü–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram!

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
mikrokredit/
‚îú‚îÄ‚îÄ app/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.py            # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db_sa.py           # SQLAlchemy
‚îÇ   ‚îú‚îÄ‚îÄ models_sa.py       # ORM –º–æ–¥–µ–ª–∏ (9 —Ç–∞–±–ª–∏—Ü)
‚îÇ   ‚îî‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ web/                    # Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ views.py           # –ó–∞–π–º—ã + Dashboard
‚îÇ   ‚îú‚îÄ‚îÄ auth_views.py      # –í—Ö–æ–¥/–≤—ã—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ tasks_views.py     # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îî‚îÄ‚îÄ templates/         # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ
‚îú‚îÄ‚îÄ Telegram –±–æ—Ç—ã:
‚îÇ   ‚îú‚îÄ‚îÄ telegram_notifier.py          # –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot_tasks.py         # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_repeat_reminders.py  # –ü–æ–≤—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ telegram_bot_server.py        # Callback (—Ñ–æ–Ω–æ–≤—ã–π)
‚îÇ
‚îú‚îÄ‚îÄ –°–∫—Ä–∏–ø—Ç—ã:
‚îÇ   ‚îú‚îÄ‚îÄ start_service.sh              # –ó–∞–ø—É—Å–∫ –≤–µ–±
‚îÇ   ‚îú‚îÄ‚îÄ stop_service.sh               # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ start_telegram_bot.sh         # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ backup_to_yandex.sh           # –ë—ç–∫–∞–ø
‚îÇ   ‚îú‚îÄ‚îÄ download_from_yandex.sh       # –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø
‚îÇ   ‚îî‚îÄ‚îÄ fix_sequences.sh              # –ò—Å–ø—Ä–∞–≤–∏—Ç—å sequences
‚îÇ
‚îî‚îÄ‚îÄ logs/                   # –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

- **Backend:** Python 3.12, Flask 3.1, SQLAlchemy 2.0
- **Database:** PostgreSQL 18.0 (mikrokredit)
- **Cache:** Redis 7.4
- **Frontend:** Bootstrap 5.3, Alpine.js
- **Telegram:** python-telegram-bot 20.8
- **Server:** Gunicorn 21.2, Nginx 1.28

### Deployment:

```
Internet ‚Üí Nginx:80 ‚Üí Gunicorn:8002 ‚Üí Flask App
                                         ‚Üì
                                   PostgreSQL:5432
                                         ‚Üì
                                   Redis:6379
                                         ‚Üë
                               Telegram Bot Server
                                         ‚Üë
                                   Telegram API
                                         ‚Üë
                                   User (Telegram)
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
Host:     localhost:5432
Database: mikrokredit
User:     mikrokredit_user
Password: [—Å–º. .env —Ñ–∞–π–ª]
```

### –¢–∞–±–ª–∏—Ü—ã:

#### –ó–∞–π–º—ã (4 —Ç–∞–±–ª–∏—Ü—ã):

**1. loans** - –º–∏–∫—Ä–æ–∑–∞–π–º—ã
- id, org_name, website
- loan_date, due_date, amount_borrowed, amount_due
- is_paid, risky_org, notes, payment_methods

**2. installments** - –ø–ª–∞—Ç–µ–∂–∏ –ø–æ —Ä–∞—Å—Å—Ä–æ—á–∫–µ
- id, loan_id, due_date, amount
- paid, paid_date

#### –ó–∞–¥–∞—á–∏ (5 —Ç–∞–±–ª–∏—Ü):

**3. tasks** - –∑–∞–¥–∞—á–∏
- id, title, description
- status (0=–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, 1=–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
- importance (1=–≤–∞–∂–Ω–∞—è, 2=–Ω—É–∂–Ω–∞—è, 3=—Ö–æ—Ç–µ–ª–æ—Å—å –±—ã)
- due_date, category_id
- is_recurring, recurrence_rule

**4. task_categories** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- id, name, color, icon

**5. subtasks** - –ø–æ–¥–∑–∞–¥–∞—á–∏
- id, task_id, title, completed, order

**6. task_reminders** - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- id, task_id, reminder_time
- sent, sent_at, telegram_message_id
- acknowledged, acknowledged_at

**7. reminder_templates** - —à–∞–±–ª–æ–Ω—ã
- id, name, description, rules (JSON)
- is_system (0/1)

---

## üí≥ –ú–æ–¥—É–ª—å –ú–∏–∫—Ä–æ–ö—Ä–µ–¥–∏—Ç

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –£—á—ë—Ç –∑–∞–π–º–æ–≤ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –ø–ª–∞—Ç–µ–∂–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –¥–æ–ª–≥–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ä—è—â–∏—Ö –∫—Ä–µ–¥–∏—Ç–∞—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –¥–æ–ª–≥–∞:

```python
# –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–π–º–∞:
unpaid_total = SUM(installments.amount WHERE paid = 0)

if unpaid_total > 0:
    debt = unpaid_total  # –ï—Å—Ç—å —Ä–∞—Å—Å—Ä–æ—á–∫–∞
else:
    debt = loan.amount_due  # –ù–µ—Ç —Ä–∞—Å—Å—Ä–æ—á–∫–∏

# –ó–∞–π–º –æ–ø–ª–∞—á–µ–Ω –µ—Å–ª–∏ unpaid_total == 0
```

### –ö—Ä–∏—Ç–µ—Ä–∏–π "–≥–æ—Ä—è—â–∏–π":

```python
# –ë–µ—Ä—ë—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–π –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π installment
next_payment = installments.where(paid=0).order_by(due_date).first()

if next_payment:
    days_left = (next_payment.due_date - today).days
    is_urgent = days_left < 5  # –ì–æ—Ä—è—â–∏–π –µ—Å–ª–∏ < 5 –¥–Ω–µ–π
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–í—Å–µ–≥–æ:** COUNT(loans)
- **–ì–æ—Ä—è—â–∏–µ:** COUNT(loans —Å days_left < 5)
- **–î–æ–ª–≥:** SUM(unpaid_total) –ø–æ –≤—Å–µ–º –∑–∞–π–º–∞–º

---

## ‚úÖ –ú–æ–¥—É–ª—å –û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä –∑–∞–¥–∞—á

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
- 3 —É—Ä–æ–≤–Ω—è –≤–∞–∂–Ω–æ—Å—Ç–∏ (üî¥üü°‚ö™)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
- –ü–æ–¥–∑–∞–¥–∞—á–∏ (—á–µ–∫–ª–∏—Å—Ç—ã)
- –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

### –í–∞–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á:

| –£—Ä–æ–≤–µ–Ω—å | –ò–∫–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| 1 | üî¥ –í–∞–∂–Ω–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ, —Å –¥–µ–¥–ª–∞–π–Ω–æ–º |
| 2 | üü° –ù—É–∂–Ω–∞—è | –ü–ª–∞–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ |
| 3 | ‚ö™ –•–æ—Ç–µ–ª–æ—Å—å –±—ã | –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ |

### –®–∞–±–ª–æ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:

**1. –ó–∞ 1 –¥–µ–Ω—å –¥–æ —Å—Ä–æ–∫–∞**
- –û–¥–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞

**2. –ó–∞ –¥–µ–Ω—å –∏ –≤ –¥–µ–Ω—å**
- –ó–∞ 24 —á–∞—Å–∞
- –£—Ç—Ä–æ–º –≤ –¥–µ–Ω—å –¥–µ–¥–ª–∞–π–Ω–∞

**3. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ** ‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
- –ó–∞ 24 —á–∞—Å–∞
- –ó–∞ 1 —á–∞—Å
- –í –º–æ–º–µ–Ω—Ç –¥–µ–¥–ª–∞–π–Ω–∞

**4. –û—á–µ–Ω—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ**
- –ó–∞ 2 –¥–Ω—è, –¥–µ–Ω—å, 3 —á–∞—Å–∞, —á–∞—Å, –º–æ–º–µ–Ω—Ç

**5. –¢–æ–ª—å–∫–æ –≤ –¥–µ–Ω—å –¥–µ–¥–ª–∞–π–Ω–∞**
- –£—Ç—Ä–æ–º –≤ –¥–µ–Ω—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—ã–µ —Ç–æ—á–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—Ä—É—á–Ω—É—é:
```
2025-10-15 09:00
2025-10-15 14:00
2025-10-15 18:00
```

---

## üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```
–ë–æ—Ç:        @valstanbot
Token:      [—Å–º. .env —Ñ–∞–π–ª - TELEGRAM_BOT_TOKEN]
Chat ID:    [—Å–º. .env —Ñ–∞–π–ª - TELEGRAM_CHAT_ID]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. telegram_notifier.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ä—è—â–∏—Ö –∑–∞–π–º–∞—Ö  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** 10:00 –∏ 20:00 MSK

**–§–æ—Ä–º–∞—Ç:**
```
üî• –ì–û–†–Ø–©–ò–ï –ö–†–ï–î–ò–¢–´ üî•

üìä –í—Å–µ–≥–æ: 5 –∫—Ä–µ–¥–∏—Ç–æ–≤
üí∞ –°—É–º–º–∞: 123,456 ‚ÇΩ

üî¥ –ü–†–û–°–†–û–ß–ï–ù –ú–∞–Ω–∏–ú–µ–Ω (13 –¥–Ω. –Ω–∞–∑–∞–¥)
üí≥ –°—É–º–º–∞: 5,056 ‚ÇΩ
üîó –ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
```

#### 2. telegram_bot_tasks.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–¥–∞—á–∞—Ö  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (cron)

**–§–æ—Ä–º–∞—Ç:**
```
üî¥ –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –û –ó–ê–î–ê–ß–ï

–û–ø–ª–∞—Ç–∏—Ç—å —Å—á—ë—Ç

üìå –í–∞–∂–Ω–æ—Å—Ç—å: –í–∞–∂–Ω–∞—è
üìÖ –°—Ä–æ–∫: 2025-10-15 18:00

[‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª]  [‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å]
```

#### 3. telegram_repeat_reminders.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ ‚Üí –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 15 –º–∏–Ω
- –î–æ —Ç–µ—Ö –ø–æ—Ä –ø–æ–∫–∞ –Ω–µ –æ—Ç—Ä–µ–∞–≥–∏—Ä—É–µ—Ç
- –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22)

#### 4. telegram_bot_server.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫  
**–†–µ–∂–∏–º:** –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ)

**–î–µ–π—Å—Ç–≤–∏—è:**
- **"‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª"** ‚Üí task.status = 1, –≤—Å–µ –±—É–¥—É—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è
- **"‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å"** ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –†–∞–±–æ—á–∏–µ —á–∞—Å—ã:
**7:00 - 22:00 MSK**

–ù–æ—á—å—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –¥–æ —É—Ç—Ä–∞.

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **–ü–∞—Ä–æ–ª—å:** [—Å–º. .env - AUTH_PASSWORD] (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- **–ü–æ–ø—ã—Ç–∫–∏:** 3
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** 5 –º–∏–Ω—É—Ç –ø–æ IP
- **Cookie:** 30 –¥–Ω–µ–π

### –ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç
   ‚Üì
2. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /auth/login
   ‚Üì
3. –í–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å
   ‚Üì
4. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Üí session['authenticated'] = True
   ‚Üì
5. Cookie –Ω–∞ 30 –¥–Ω–µ–π
   ‚Üì
6. –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º
```

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:

```
–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (1 —Ä–∞–∑) ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 2 –ø–æ–ø—ã—Ç–∫–∏
–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (2 —Ä–∞–∑) ‚Üí –æ—Å—Ç–∞–ª–æ—Å—å 1 –ø–æ–ø—ã—Ç–∫–∞
–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (3 —Ä–∞–∑) ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –Ω–∞ 5 –º–∏–Ω—É—Ç
```

- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞—à–µ–≥–æ IP
- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Cron)

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:

```bash
# –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
* * * * *           telegram_bot_tasks.py

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏)
*/15 * * * *        telegram_repeat_reminders.py

# –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã
0 10,20 * * *       telegram_notifier.py

# –ë—ç–∫–∞–ø –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫
0 2 * * *           backup_to_yandex.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ cron:
```bash
crontab -l                           # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
grep CRON /var/log/syslog | tail    # –õ–æ–≥–∏ –∑–∞–ø—É—Å–∫–æ–≤
```

---

## üíæ –ë—ç–∫–∞–ø—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ:
- **–ö–æ–≥–¥–∞:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00 MSK
- **–ö—É–¥–∞:** –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ (–ø–∞–ø–∫–∞ /–ú–∏–∫—Ä–æ–ö—Ä–µ–¥–∏—Ç_Backups)
- **–§–æ—Ä–º–∞—Ç:** SQL dump + gzip (~8 KB)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** 10 –Ω–∞ –Ø.–î–∏—Å–∫–µ, 3 –ª–æ–∫–∞–ª—å–Ω–æ
- **–°—Å—ã–ª–∫–∞:** https://yadi.sk/d/gVpI3Fst7J5EIw

### –ö–æ–º–∞–Ω–¥—ã:

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —Å–µ–π—á–∞—Å
./backup_to_yandex.sh

# –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤ –Ω–∞ –Ø.–î–∏—Å–∫–µ
./download_from_yandex.sh

# –°–∫–∞—á–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π
./download_from_yandex.sh latest

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
gunzip mikrokredit_*.sql.gz
export PGPASSWORD="[—Å–º. .env - DB_PASSWORD]"
psql -U mikrokredit_user -d mikrokredit -h localhost < backup.sql
```

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –ó–∞–ø—É—Å–∫:

```bash
cd /home/valstan/mikrokredit

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä
./start_service.sh

# Telegram –±–æ—Ç (callback)
./start_telegram_bot.sh
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
# –í–µ–±-—Å–µ—Ä–≤–µ—Ä
./stop_service.sh

# Telegram –±–æ—Ç
pkill -f telegram_bot_server.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
# Health check
curl http://localhost/healthz

# –ü—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(gunicorn|telegram)" | grep -v grep

# –õ–æ–≥–∏
tail -f logs/error.log              # –û—à–∏–±–∫–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f logs/telegram_tasks.log     # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
tail -f logs/telegram_bot_fresh.log # Telegram –±–æ—Ç (callback)
tail -f logs/backup.log             # –ë—ç–∫–∞–ø—ã
```

---

## üìä –†–∞–±–æ—Ç–∞ —Å –∑–∞–π–º–∞–º–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–π–º–∞:

1. –ó–∞–π–º—ã ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–π–º"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - –ë–∞–Ω–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ)
   - –°–∞–π—Ç (URL –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞)
   - –î–∞—Ç–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
   - –î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
   - –°—É–º–º–∞ –≤–∑—è—Ç–∞
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π:

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–π–º–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–π–º –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –†–∞–∑–¥–µ–ª "–ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π"
3. –î–æ–±–∞–≤—å—Ç–µ –∫–∞–∂–¥—ã–π –ø–ª–∞—Ç—ë–∂:
   - –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
   - –°—É–º–º–∞
4. "–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂"

**–í–∞–∂–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°—É–º–º–∏—Ä—É–µ—Ç –æ–±—â—É—é —Å—É–º–º—É –∫ –≤–æ–∑–≤—Ä–∞—Ç—É
- –í—ã—á–∏—Å–ª—è–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–ª–∏–∂–∞–π—à–∏–π –ø–ª–∞—Ç—ë–∂
- –ü–æ–º–µ—á–∞–µ—Ç –≥–æ—Ä—è—â–∏–µ (< 5 –¥–Ω–µ–π)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- **–í—Å–µ–≥–æ –∑–∞–π–º–æ–≤:** COUNT(loans)
- **–ì–æ—Ä—è—â–∏–µ:** –∑–∞–π–º—ã —Å –±–ª–∏–∂–∞–π—à–∏–º –ø–ª–∞—Ç–µ–∂–æ–º < 5 –¥–Ω–µ–π
- **–î–æ–ª–≥:** —Å—É–º–º–∞ –≤—Å–µ—Ö –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö installments

---

## ‚úÖ –†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:

1. –ó–∞–¥–∞—á–∏ ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - **–í–∞–∂–Ω–æ—Å—Ç—å:** –í–∞–∂–Ω–∞—è/–ù—É–∂–Ω–∞—è/–•–æ—Ç–µ–ª–æ—Å—å –±—ã
   - **–°—Ä–æ–∫:** –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
   - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - **–û–ø–∏—Å–∞–Ω–∏–µ** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ò–õ–ò –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

### –ü–æ–¥–∑–∞–¥–∞—á–∏ (—á–µ–∫–ª–∏—Å—Ç—ã):

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Ä–∞–∑–±–∏–≤–∫–∏ –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–∏:

```
–ó–∞–¥–∞—á–∞: –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è

–ü–æ–¥–∑–∞–¥–∞—á–∏:
‚îú‚îÄ ‚¨ú –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω
‚îú‚îÄ ‚¨ú –ó–∞–∫–∞–∑–∞—Ç—å —Ç–æ—Ä—Ç
‚îú‚îÄ ‚¨ú –ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
‚îî‚îÄ ‚¨ú –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≥–æ—Å—Ç–µ–π

–ü—Ä–æ–≥—Ä–µ—Å—Å: 0/4
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ó–∞–¥–∞—á–∏ ‚Üí "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏"
- –î–æ–±–∞–≤—å—Ç–µ: –Ω–∞–∑–≤–∞–Ω–∏–µ + —Ü–≤–µ—Ç

**–ü—Ä–∏–º–µ—Ä—ã:**
- üî¥ –†–∞–±–æ—Ç–∞ (#dc3545)
- üü¢ –õ–∏—á–Ω–æ–µ (#28a745)
- üîµ –°–µ–º—å—è (#007bff)

### –§–∏–ª—å—Ç—Ä—ã:

- –í—Å–µ –∑–∞–¥–∞—á–∏
- –ù–∞ —Å–µ–≥–æ–¥–Ω—è
- –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ
- –í–∞–∂–Ω—ã–µ
- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
- –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

---

## üì± Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:

#### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞—á–µ:
```
üî¥ –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –û –ó–ê–î–ê–ß–ï

–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–û–ø–∏—Å–∞–Ω–∏–µ

üìå –í–∞–∂–Ω–æ—Å—Ç—å: –í–∞–∂–Ω–∞—è
üìÖ –°—Ä–æ–∫: 2025-10-15 18:00

[‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª]  [‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å]
```

#### –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:
```
üî¥ üîî –ü–û–í–¢–û–†–ù–û–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï

–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

‚è∞ –ü–µ—Ä–≤–æ–µ –±—ã–ª–æ: 10:00
üí° –°–ª–µ–¥—É—é—â–µ–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç

[‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª]  [‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å]
```

#### –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã:
```
üî• –ì–û–†–Ø–©–ò–ï –ö–†–ï–î–ò–¢–´ üî•

üìä –í—Å–µ–≥–æ: 5 –∫—Ä–µ–¥–∏—Ç–æ–≤
üí∞ –°—É–º–º–∞: 123,456 ‚ÇΩ

üî¥ –ü–†–û–°–†–û–ß–ï–ù –ú–∞–Ω–∏–ú–µ–Ω (13 –¥–Ω.)
üí≥ –°—É–º–º–∞: 5,056 ‚ÇΩ
üîó –ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
```

### –ö–Ω–æ–ø–∫–∏ –≤ Telegram:

**"‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª":**
- –ó–∞–¥–∞—á–∞ ‚Üí status = 1 (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
- –í—Å–µ –±—É–¥—É—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: "–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! üéâ"

**"‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å":**
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–¥–∞—á—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–∞–±–æ—á–∏–µ —á–∞—Å—ã:

**7:00 - 22:00 MSK**

- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ –≤—Ä–µ–º—è
- –ù–æ—á—å—é –±–æ—Ç –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç
- –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏–¥—É—Ç –≤ 7:00

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–µ–∫—Ä–µ—Ç—ã:

**–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git:**
- Auth password: [—Å–º. .env - AUTH_PASSWORD]
- Telegram token: [—Å–º. .env —Ñ–∞–π–ª - TELEGRAM_BOT_TOKEN]
- DB password: [—Å–º. .env - DB_PASSWORD]
- Yandex token: [—Å–º. .env —Ñ–∞–π–ª - YANDEX_DISK_TOKEN]

### –ò–∑–º–µ–Ω—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

**–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –±–æ—Ç–∞:**
```python
# –í —Ñ–∞–π–ª–∞—Ö telegram_*.py
BOT_WORK_HOURS_START = 7   # –ù–∞—á–∞–ª–æ
BOT_WORK_HOURS_END = 22    # –ö–æ–Ω–µ—Ü
```

**–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–æ–≤:**
```python
# –í telegram_repeat_reminders.py
REPEAT_INTERVAL_MINUTES = 15
```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ä—è—â–µ–≥–æ –∑–∞–π–º–∞:**
```python
# –í web/views.py
urgent = days_left < 5  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω—É–∂–Ω–æ–µ
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Internal Server Error

**–°–∏–º–ø—Ç–æ–º—ã:** –ë–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ—à–∏–±–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -50 logs/error.log

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ PostgreSQL
systemctl status postgresql

# 3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ sequences (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ duplicate key)
./fix_sequences.sh

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
./stop_service.sh && ./start_service.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–Ω–æ–ø–∫–∏ –≤ Telegram

**–ü—Ä–∏—á–∏–Ω—ã:**
- Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –°—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ (callback –∏—Å—Ç—ë–∫)
- –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
ps aux | grep telegram_bot_server

# 2. –õ–æ–≥–∏
tail -20 logs/telegram_bot_fresh.log

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pkill -f telegram_bot_server.py
./start_telegram_bot.sh

# 4. –°–æ–∑–¥–∞–π—Ç–µ –ù–û–í–£–Æ –∑–∞–¥–∞—á—É –¥–ª—è —Å–≤–µ–∂–∏—Ö –∫–Ω–æ–ø–æ–∫
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# 1. Cron –Ω–∞—Å—Ç—Ä–æ–µ–Ω?
crontab -l

# 2. –†–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22 MSK)?
date +%H

# 3. –ï—Å—Ç—å –ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –ë–î?
export PGPASSWORD="[—Å–º. .env - DB_PASSWORD]"
psql -U mikrokredit_user -d mikrokredit -h localhost -c \
  "SELECT * FROM task_reminders WHERE sent = 0;"

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
python3 telegram_bot_tasks.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–ª–∞—Ç—ë–∂

**–†–µ—à–µ–Ω–∏–µ:**
- –§–æ—Ä–º—ã —Ç–µ–ø–µ—Ä—å –æ–±—ã—á–Ω—ã–µ POST (–±–µ–∑ HTMX)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -20 logs/error.log`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∞—Ç–∞ –ò —Å—É–º–º–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Duplicate key (sequences)

**–û—à–∏–±–∫–∞:**
```
duplicate key value violates unique constraint "loans_pkey"
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
./fix_sequences.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ sequences.

---

## üìà –ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏

### –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∑–∞–¥–∞—á:

1. –ó–∞–¥–∞—á–∏ ‚Üí "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏"
2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç
3. "–î–æ–±–∞–≤–∏—Ç—å"

### –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —à–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `init_reminder_templates.py`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ SYSTEM_TEMPLATES
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `python3 init_reminder_templates.py`

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–¥–∞—á–∞–º
SELECT 
    importance,
    COUNT(*) as total,
    SUM(CASE WHEN status = 0 THEN 1 ELSE 0 END) as pending,
    SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) as completed
FROM tasks
GROUP BY importance;

-- –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã
SELECT 
    l.org_name,
    MIN(i.due_date) as next_payment,
    SUM(i.amount) FILTER (WHERE i.paid = 0) as debt
FROM loans l
LEFT JOIN installments i ON i.loan_id = l.id
WHERE l.is_paid = 0
GROUP BY l.id, l.org_name
HAVING MIN(i.due_date) < CURRENT_DATE + INTERVAL '5 days';
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã:

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –ï–¥–∏–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ (3 –ø–æ–ø—ã—Ç–∫–∏)
   - –ó–∞—â–∏—Ç–∞ –ø–æ IP
   - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Å—Å–∏—è (httponly cookie)

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - Dedicated user (–Ω–µ postgres)
   - –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ
   - –°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - Connection pooling —Å pre-ping

3. **Telegram**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ chat_id
   - –¢–æ–∫–µ–Ω –Ω–µ –≤ git (–≤ .gitignore)
   - –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ callback

4. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**
   - –ó–∞ Nginx reverse proxy
   - Security headers
   - CSRF protection (Flask)
   - ProxyFix –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ IP

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞:

**–£—Ç—Ä–æ–º:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Dashboard
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã
4. –†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

**–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è:**
- –†–µ–∞–≥–∏—Ä—É–π—Ç–µ –Ω–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ "–í—ã–ø–æ–ª–Ω–∏–ª"/"–û—Ç–ª–æ–∂–∏—Ç—å"
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ - –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—ã

**–í–µ—á–µ—Ä–æ–º:**
- –û—Ç–º–µ—Ç—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞—Ç–µ–∂–∏

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:

**–ó–∞–¥–∞—á–∏:**
- –í–∞–∂–Ω—ã–µ ‚Üí –¥–ª—è –¥–µ–¥–ª–∞–π–Ω–æ–≤
- –ù—É–∂–Ω—ã–µ ‚Üí –¥–ª—è –ø–ª–∞–Ω–æ–≤—ã—Ö –¥–µ–ª
- –•–æ—Ç–µ–ª–æ—Å—å –±—ã ‚Üí –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ñ–µ—Ä –∂–∏–∑–Ω–∏

**–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:**
- "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ" –¥–ª—è –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á
- "–ó–∞ –¥–µ–Ω—å –∏ –≤ –¥–µ–Ω—å" –¥–ª—è –æ–±—ã—á–Ω—ã—Ö
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–ª—è –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞–µ–≤

---

## üéØ –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–±–æ—Ç—ã

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏:

```
1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
   ‚Üì
2. –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
   ‚Üì
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è task_reminders
   ‚Üì
4. Cron –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
   ‚Üì
5. –í—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–ø–æ–ª–Ω–∏–ª"
   ‚Üì
7. Callback ‚Üí task.status = 1
   ‚Üì
8. –£–¥–∞–ª–µ–Ω–∏–µ –±—É–¥—É—â–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
   ‚Üì
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–í—ã–ø–æ–ª–Ω–µ–Ω–∞!"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```
1. –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
   ‚Üì
2. –ù–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ 15 –º–∏–Ω—É—Ç
   ‚Üì
3. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
   ‚Üì
4. –°–Ω–æ–≤–∞ –Ω–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ 15 –º–∏–Ω—É—Ç
   ‚Üì
5. –ï—â—ë –ø–æ–≤—Ç–æ—Ä (—Ü–∏–∫–ª –¥–æ —Ä–µ–∞–∫—Ü–∏–∏)
   ‚Üì
6. –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22)
```

---

## üìö –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```
Host:     localhost:5432
Database: mikrokredit
User:     mikrokredit_user
Password: [—Å–º. .env —Ñ–∞–π–ª]
```

### Gunicorn (gunicorn.conf.py):
```python
bind = "127.0.0.1:8002"
workers = 4
timeout = 30
pool_size = 10
max_overflow = 20
pool_pre_ping = True  # –†–µ—à–∞–µ—Ç SSL SYSCALL errors
```

### Nginx (nginx.conf):
```nginx
location / {
    proxy_pass http://127.0.0.1:8002;
    # Headers –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ IP
}
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```bash
# === –°–ï–†–í–ò–°–´ ===
systemctl status postgresql nginx redis-server

# === –ü–†–û–¶–ï–°–°–´ ===
ps aux | grep gunicorn | grep mikrokredit
ps aux | grep telegram_bot_server

# === –ë–ê–ó–ê –î–ê–ù–ù–´–• ===
export PGPASSWORD="[—Å–º. .env - DB_PASSWORD]"
psql -U mikrokredit_user -d mikrokredit -h localhost -c "\dt"

# === CRON ===
crontab -l

# === –õ–û–ì–ò ===
ls -lh logs/

# === –î–ò–°–ö ===
df -h /
du -sh backups/ logs/

# === HEALTH ===
curl http://localhost/healthz
```

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
./stop_service.sh
pkill -f telegram_bot_server.py
sleep 2
./start_service.sh
./start_telegram_bot.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost/healthz
ps aux | grep -E "(gunicorn|telegram)"
```

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ë–î:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
export PGPASSWORD="[—Å–º. .env - DB_PASSWORD]"
psql -U mikrokredit_user -d mikrokredit -h localhost -c "SELECT 1;"

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ sequences
./fix_sequences.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PostgreSQL (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sudo systemctl restart postgresql
```

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:

```bash
# –°–∫–∞—á–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø
./download_from_yandex.sh latest

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
gunzip mikrokredit_*.sql.gz
export PGPASSWORD="[—Å–º. .env - DB_PASSWORD]"
psql -U mikrokredit_user -d mikrokredit -h localhost < backup.sql

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å sequences
./fix_sequences.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
./stop_service.sh && ./start_service.sh
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å—Å—ã–ª–∫–∏

**–î–æ—Å—Ç—É–ø:**
- –í–µ–±: http://73269587c9af.vps.myjino.ru/
- GitHub: github.com/Valstan/mikrokredit
- –ë—ç–∫–∞–ø—ã: https://yadi.sk/d/gVpI3Fst7J5EIw

**Telegram:**
- –ë–æ—Ç: @valstanbot
- Chat ID: [—Å–º. .env —Ñ–∞–π–ª - TELEGRAM_CHAT_ID]

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
- –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
- –î–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π: PROJECT_ARCHITECTURE.md (–≤ docs/)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 09.10.2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

**–ü—Ä–∏—è—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã!** üéØ

