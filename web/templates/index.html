{% extends 'base.html' %}
{% block content %}

<style>
.loan-row {
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.loan-row:hover {
    filter: brightness(0.95);
}

.loan-row-neutral {
    background-color: #f8f9fa !important;
}

.loan-row-urgent {
    background-color: #f8d7da !important;
}

.loan-row-warning {
    background-color: #fff3cd !important;
}

.loan-row-paid {
    background-color: #d1e7dd !important;
}
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>–ö—Ä–µ–¥–∏—Ç—ã
    <small class="text-muted" style="font-weight: normal;">
      | –ì–æ—Ä—è—â–∏–µ: {{ urgent_count or 0 }} | –í—Å–µ–≥–æ: {{ total_count or 0 }} | –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ: {{ '%.2f'|format(total_remaining or 0) }}
    </small>
  </h4>
  <a href="{{ url_for('views.loan_new_v2') }}" class="btn btn-success">
    <i class="bi bi-plus-lg"></i> üí≥ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–π–º
  </a>
</div>

<div class="table-responsive">
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>–ë–∞–Ω–∫</th>
      <th>–ü–ª–∞—Ç–µ–∂ (–¥–∞—Ç–∞)</th>
      <th>–ü–ª–∞—Ç–µ–∂</th>
      <th>–û—Å—Ç–∞–ª–æ—Å—å</th>
      <th>–°–∞–π—Ç</th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
    {% set l = it.loan %}
    <tr class="loan-row {{ 'loan-row-paid' if it.paid else ('loan-row-urgent' if it.urgent else ('loan-row-warning' if it.next_date else 'loan-row-neutral')) }}" 
        onclick="window.location.href='/loan/{{ l.id }}/v2';">
      <td>{{ l.id }}</td>
      <td>{{ l.org_name }}</td>
      <td>{{ it.next_date or '' }}</td>
      <td>{{ '%.2f'|format(it.next_amount) if it.next_amount is not none else '' }}</td>
      <td class="text-end">{{ '%.2f'|format(it.remaining) }}</td>
      <td onclick="event.stopPropagation();">
        {% if l.website %}
          <a class="btn btn-outline-secondary btn-sm" href="{{ l.website if l.website.startswith('http') else 'https://' ~ l.website }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –±–∞–Ω–∫–∞</a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
