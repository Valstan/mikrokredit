{% extends "base.html" %}

{% block title %}{% if task %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É{% else %}–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞{% endif %}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    {% if task %}
                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É
                    {% else %}
                        <i class="bi bi-plus-circle"></i> –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
                    {% endif %}
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{% if task %}{{ url_for('tasks.edit', task_id=task.id) }}{% else %}{{ url_for('tasks.new') }}{% endif %}">
                    
                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <div class="mb-3">
                        <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                        <input type="text" class="form-control" id="title" name="title" 
                               value="{% if task %}{{ task.title }}{% endif %}" required>
                    </div>
                    
                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <div class="mb-3">
                        <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="description" name="description" rows="3">{% if task %}{{ task.description }}{% endif %}</textarea>
                    </div>
                    
                    <div class="row">
                        <!-- –í–∞–∂–Ω–æ—Å—Ç—å -->
                        <div class="col-md-4 mb-3">
                            <label for="importance" class="form-label">–í–∞–∂–Ω–æ—Å—Ç—å *</label>
                            <select class="form-select" id="importance" name="importance" required>
                                <option value="1" {% if task and task.importance == 1 %}selected{% endif %}>üî¥ –í–∞–∂–Ω–∞—è</option>
                                <option value="2" {% if task and task.importance == 2 %}selected{% elif not task %}selected{% endif %}>üü° –ù—É–∂–Ω–∞—è</option>
                                <option value="3" {% if task and task.importance == 3 %}selected{% endif %}>‚ö™ –•–æ—Ç–µ–ª–æ—Å—å –±—ã</option>
                            </select>
                        </div>
                        
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                        <div class="col-md-4 mb-3">
                            <label for="category_id" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select class="form-select" id="category_id" name="category_id">
                                <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                {% for cat in categories %}
                                <option value="{{ cat.id }}" {% if task and task.category_id == cat.id %}selected{% endif %}>
                                    {{ cat.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
                        <div class="col-md-4 mb-3">
                            <label for="due_date" class="form-label">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                            <input type="datetime-local" class="form-control" id="due_date" name="due_date" 
                                   value="{% if task and task.due_date %}{{ task.due_date[:16] }}{% endif %}">
                        </div>
                    </div>
                    
                    <!-- –ü–æ–¥–∑–∞–¥–∞—á–∏ -->
                    <div class="mb-3">
                        <label class="form-label">–ü–æ–¥–∑–∞–¥–∞—á–∏ (—á–µ–∫–ª–∏—Å—Ç)</label>
                        <div id="subtasks-container">
                            {% if task and task.subtasks %}
                                {% for subtask in task.subtasks %}
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" name="subtask_title[]" 
                                           value="{{ subtask.title }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏">
                                    <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addSubtask()">
                            <i class="bi bi-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∑–∞–¥–∞—á—É
                        </button>
                    </div>
                    
                    <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                        
                        <!-- –®–∞–±–ª–æ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π -->
                        <div class="mb-2">
                            <select class="form-select" id="reminder_template" name="reminder_template">
                                <option value="">–í—ã–±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω...</option>
                                {% for template in templates %}
                                <option value="{{ template.id }}">{{ template.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∏–∂–µ</small>
                        </div>
                        
                        <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
                        <div id="reminders-container">
                            {% if task and task.reminders %}
                                {% for reminder in task.reminders %}
                                <div class="input-group mb-2">
                                    <input type="datetime-local" class="form-control" name="reminder_time[]" 
                                           value="{{ reminder.reminder_time[:16] }}">
                                    <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addReminder()">
                            <i class="bi bi-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
                        </button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('tasks.index') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function addSubtask() {
    const container = document.getElementById('subtasks-container');
    const div = document.createElement('div');
    div.className = 'input-group mb-2';
    div.innerHTML = `
        <input type="text" class="form-control" name="subtask_title[]" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏">
        <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">
            <i class="bi bi-trash"></i>
        </button>
    `;
    container.appendChild(div);
}

function addReminder() {
    const container = document.getElementById('reminders-container');
    const div = document.createElement('div');
    div.className = 'input-group mb-2';
    div.innerHTML = `
        <input type="datetime-local" class="form-control" name="reminder_time[]">
        <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">
            <i class="bi bi-trash"></i>
        </button>
    `;
    container.appendChild(div);
}
</script>
{% endblock %}

