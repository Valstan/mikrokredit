# üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Nginx –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ VPS

> **–î–ª—è AI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ**  
> –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Nginx –≤ –ø—Ä–æ–µ–∫—Ç–µ "–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞" (MikroKredit Manager) –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç

**–°–µ—Ä–≤–µ—Ä:** Ubuntu 24.04.3 LTS  
**Nginx –≤–µ—Ä—Å–∏—è:** 1.28.0  
**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** Flask + Gunicorn  
**URL:** http://73269587c9af.vps.myjino.ru/

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Internet (port 80)
    ‚Üì
Nginx (—Å–ª—É—à–∞–µ—Ç 0.0.0.0:80)
    ‚Üì
Reverse Proxy ‚Üí Gunicorn (—Å–ª—É—à–∞–µ—Ç 127.0.0.1:8002)
    ‚Üì
Flask Application
    ‚Üì
PostgreSQL / Redis
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** Nginx —Å–ª—É—à–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç 80 –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π Gunicorn (127.0.0.1:8002).

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

### 1. –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥

**–§–∞–π–ª:** `/etc/nginx/nginx.conf`

**–í–∞–∂–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:**
```nginx
include /etc/nginx/conf.d/*.conf;
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Nginx –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç **–í–°–ï** —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.conf` –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/etc/nginx/conf.d/`.

### 2. –ö–æ–Ω—Ñ–∏–≥ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `/etc/nginx/conf.d/mikrokredit.conf`

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ò–º–µ–Ω–Ω–æ –≤ `conf.d/`, –ù–ï –≤ `sites-enabled/` –∏–ª–∏ `sites-available/` (–∏—Ö –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç).

---

## üîß –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

–í–æ—Ç **–¢–û–ß–ù–´–ô** –∫–æ–Ω—Ñ–∏–≥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —É –Ω–∞—Å:

```nginx
server {
    # –°–ª—É—à–∞–µ–º –ø–æ—Ä—Ç 80 –∫–∞–∫ default_server
    # –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ Nginx –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –í–°–ï –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç 80
    listen 80 default_server;
    
    # Server name "_" –æ–∑–Ω–∞—á–∞–µ—Ç "–ª—é–±–æ–π —Ö–æ—Å—Ç"
    # Nginx –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –ª—é–±–æ–π –¥–æ–º–µ–Ω/IP –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑–∞–Ω –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä
    server_name _;

    # === SECURITY HEADERS ===
    # –í–∞–∂–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    # === LOGGING ===
    access_log /var/log/nginx/mikrokredit_access.log;
    error_log /var/log/nginx/mikrokredit_error.log;

    # === STATIC FILES (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
    # –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
    location /static {
        alias /home/valstan/mikrokredit/web/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # === MAIN APPLICATION ===
    # –°–ê–ú–ê–Ø –í–ê–ñ–ù–ê–Ø –ß–ê–°–¢–¨!
    location / {
        # –ü—Ä–æ–∫—Å–∏—Ä—É–µ–º –Ω–∞ Gunicorn
        proxy_pass http://127.0.0.1:8002;
        
        # –ü–µ—Ä–µ–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –¢–∞–π–º–∞—É—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫—É–Ω–¥ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å)
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
    }

    # === HEALTH CHECK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
    # –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    location /healthz {
        proxy_pass http://127.0.0.1:8002/healthz;
        access_log off;  # –ù–µ –ª–æ–≥–∏—Ä—É–µ–º health checks
    }
}
```

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
cat /etc/nginx/nginx.conf | grep include

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
# include /etc/nginx/conf.d/*.conf;
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sites-enabled/`:**
```bash
# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (Debian/Ubuntu —Å—Ç–∏–ª—å)
# include /etc/nginx/sites-enabled/*;
```

### –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Gunicorn —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å Gunicorn
ps aux | grep gunicorn

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
# gunicorn --bind 127.0.0.1:8000 app:app
```

**–í–∞–∂–Ω–æ:** –ó–∞–ø–æ–º–Ω–∏—Ç–µ –Ω–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç Gunicorn (—É –Ω–∞—Å `8002`, —É –≤–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å `8000` –∏–ª–∏ –¥—Ä—É–≥–æ–π).

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª (–∑–∞–º–µ–Ω–∏—Ç–µ PROJECT –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
sudo nano /etc/nginx/conf.d/PROJECT.conf
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```nginx
server {
    listen 80 default_server;
    server_name _;

    location / {
        proxy_pass http://127.0.0.1:8000;  # –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç!
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**–í–ê–ñ–ù–û:** –ó–∞–º–µ–Ω–∏—Ç–µ `8000` –Ω–∞ –ø–æ—Ä—Ç –≤–∞—à–µ–≥–æ Gunicorn!

### –®–∞–≥ 4: –£–¥–∞–ª–∏—Ç–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (–µ—Å–ª–∏ –µ—Å—Ç—å)

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ default.conf
ls -la /etc/nginx/conf.d/

# –ï—Å–ª–∏ –µ—Å—Ç—å default.conf, –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –µ–≥–æ
sudo mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak
```

**–ü–æ—á–µ–º—É?** –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å `listen 80 default_server`, Nginx –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:** –ß–∏—Ç–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, —Ç–∞–º —É–∫–∞–∑–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∏ –ø—Ä–∏—á–∏–Ω–∞.

### –®–∞–≥ 6: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx

```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–º—è–≥–∫–∏–π —Å–ø–æ—Å–æ–±)
sudo nginx -s reload

# –ò–õ–ò –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–µ—Å–ª–∏ reload –Ω–µ –ø–æ–º–æ–≥)
sudo systemctl restart nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status nginx
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Nginx —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 80
sudo ss -tulpn | grep :80

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# tcp   LISTEN  0.0.0.0:80    nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Gunicorn —Å–ª—É—à–∞–µ—Ç —Å–≤–æ–π –ø–æ—Ä—Ç
sudo ss -tulpn | grep :8000  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# tcp   LISTEN  127.0.0.1:8000    python3
```

### –®–∞–≥ 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è HTML –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–Ω–µ (—Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä)
# http://YOUR_SERVER_IP/
```

---

## üêõ Troubleshooting: –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "502 Bad Gateway"

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Gunicorn.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Gunicorn —Ä–∞–±–æ—Ç–∞–µ—Ç
ps aux | grep gunicorn

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É
sudo ss -tulpn | grep python

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç –≤ nginx.conf –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
grep proxy_pass /etc/nginx/conf.d/*.conf

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Connection refused"

**–ü—Ä–∏—á–∏–Ω–∞:** Gunicorn —Å–ª—É—à–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# Gunicorn –î–û–õ–ñ–ï–ù —Å–ª—É—à–∞—Ç—å 127.0.0.1 (localhost)
# –í –≤–∞—à–µ–º —Å–∫—Ä–∏–ø—Ç–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
gunicorn --bind 127.0.0.1:8000 app:app

# –ù–ï 0.0.0.0:8000 (—Ö–æ—Ç—è —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "–°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç 80**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
   sudo ufw status
   
   # –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 80
   sudo ufw allow 80/tcp
   sudo ufw reload
   ```

2. **Nginx –Ω–µ —Å–ª—É—à–∞–µ—Ç 0.0.0.0:80**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Nginx —Å–ª—É—à–∞–µ—Ç –í–°–ï –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
   sudo ss -tulpn | grep :80
   
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   # 0.0.0.0:80  (–∞ –Ω–µ 127.0.0.1:80)
   ```

3. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä VPS –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç**
   ```bash
   # –£—Ç–æ—á–Ω–∏—Ç–µ —É —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   # –ù–µ–∫–æ—Ç–æ—Ä—ã–µ VPS —Ç—Ä–µ–±—É—é—Ç –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "nginx: [emerg] bind() to 0.0.0.0:80 failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç 80 —É–∂–µ –∑–∞–Ω—è—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞–π–¥–∏—Ç–µ —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç
sudo lsof -i :80

# –ï—Å–ª–∏ —ç—Ç–æ Apache –∏–ª–∏ –¥—Ä—É–≥–æ–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
sudo systemctl stop apache2
sudo systemctl disable apache2

# –ü–æ—Ç–æ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
sudo systemctl start nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Nginx –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ–Ω—Ñ–∏–≥–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à –∫–æ–Ω—Ñ–∏–≥ –∏–º–µ–µ—Ç default_server
grep "default_server" /etc/nginx/conf.d/*.conf

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –û–î–ù–ê —Å—Ç—Ä–æ–∫–∞ —Å default_server

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
sudo nginx -T | grep "server_name"
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–∏—Å–∞—Ç—å "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] Gunicorn –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (`ps aux | grep gunicorn`)
- [ ] Gunicorn —Å–ª—É—à–∞–µ—Ç 127.0.0.1:–ü–û–†–¢ (`ss -tulpn | grep –ü–û–†–¢`)
- [ ] Nginx –∑–∞–ø—É—â–µ–Ω (`systemctl status nginx`)
- [ ] Nginx —Å–ª—É—à–∞–µ—Ç 0.0.0.0:80 (`ss -tulpn | grep :80`)
- [ ] –ö–æ–Ω—Ñ–∏–≥ Nginx –≤–∞–ª–∏–¥–Ω—ã–π (`nginx -t`)
- [ ] –ü–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç –≤ firewall (`ufw status`)
- [ ] proxy_pass —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç Gunicorn
- [ ] –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫ (`tail -f /var/log/nginx/error.log`)
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (`curl http://localhost`)

---

## üìù –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—á–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è FastAPI/Flask

### –î–ª—è FastAPI (–∫–∞–∫ —É –ø—Ä–æ–µ–∫—Ç–∞ SETKA)

```nginx
server {
    listen 80 default_server;
    server_name _;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –î–ª—è WebSocket (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

### –ó–∞–ø—É—Å–∫ FastAPI —á–µ—Ä–µ–∑ Uvicorn

```bash
# –í —Ñ–æ–Ω–µ
nohup uvicorn main:app --host 127.0.0.1 --port 8000 > /dev/null 2>&1 &

# –ò–ª–∏ —á–µ—Ä–µ–∑ systemd (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
# –°–æ–∑–¥–∞–π—Ç–µ /etc/systemd/system/fastapi.service
```

---

## üîí –ë–æ–Ω—É—Å: SSL/HTTPS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ HTTPS:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
sudo certbot --nginx -d yourdomain.com

# Certbot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥ Nginx!
```

---

## üìû –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
sudo nginx -s reload

# –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)
sudo nginx -T

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo ss -tulpn | grep -E "(80|8000|8002)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep -E "(nginx|gunicorn|uvicorn)"

# –¢–µ—Å—Ç —Å –ª–æ–∫–∞–ª—Ö–æ—Å—Ç–∞
curl -v http://localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–≤–Ω–µ (—Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)
curl -v http://YOUR_SERVER_IP
```

---

## üéØ –ì–ª–∞–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —É—Å–ø–µ—Ö–∞

1. **Gunicorn —Å–ª—É—à–∞–µ—Ç `127.0.0.1:–ü–û–†–¢`** (–ù–ï 0.0.0.0)
2. **Nginx —Å–ª—É—à–∞–µ—Ç `0.0.0.0:80`** (–ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
3. **–ö–æ–Ω—Ñ–∏–≥ –≤ `/etc/nginx/conf.d/`** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.conf`
4. **`proxy_pass http://127.0.0.1:–ü–û–†–¢`** –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –ø–æ—Ä—Ç–æ–º Gunicorn
5. **–¢–æ–ª—å–∫–æ –æ–¥–∏–Ω `default_server`** –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö
6. **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** `nginx -t` ‚Üí `nginx -s reload`
7. **–ü–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç** –≤ firewall –∏ —É VPS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

## üí° –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ:

1. –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã: `sudo nginx -T | head -100`
2. –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã: `ps aux | grep -E "(gunicorn|uvicorn|python)"`
3. –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã: `sudo ss -tulpn | grep -E "(80|8000)"`
4. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤: `sudo tail -50 /var/log/nginx/error.log`
5. –í—ã–≤–æ–¥: `curl -v http://localhost`

–£–¥–∞—á–∏! üöÄ

---

**–ê–≤—Ç–æ—Ä:** AI Assistant –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ "–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞"  
**–î–∞—Ç–∞:** 10.10.2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞:** Ubuntu 24.04.3 LTS, Nginx 1.28.0

