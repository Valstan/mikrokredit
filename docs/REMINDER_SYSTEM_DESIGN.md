# 🎨 Дизайн гибкой системы напоминаний

**Дата**: 10 октября 2025  
**Автор**: AI Assistant  
**Версия**: 2.0 (Расширенная)

---

## 🎯 Цели системы

1. **Гибкость**: Пользователь может создавать любые комбинации правил
2. **Простота**: Интуитивный UI с визуальными пресетами
3. **Мощность**: Поддержка сложных сценариев (как "Футбол - сын")
4. **Переиспользование**: Сохранение шаблонов для повторного использования

---

## 📊 Архитектура системы

### Уровень 1: Типы правил (Rule Types)

Базовые блоки для построения напоминаний:

```
┌─────────────────────────────────────────────────────────┐
│ ТИПЫ ПРАВИЛ НАПОМИНАНИЙ                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 1. ⏰ ОДИНОЧНЫЕ (Single)                                │
│    ├─ before_start     - За X до начала                │
│    ├─ at_start         - В момент начала                │
│    ├─ before_end       - За X до конца                  │
│    ├─ at_end           - В момент окончания             │
│    └─ after_end        - Через X после окончания        │
│                                                          │
│ 2. 🔁 ПЕРИОДИЧЕСКИЕ (Periodic)                          │
│    ├─ periodic_before  - Каждые X мин до начала         │
│    ├─ periodic_during  - Каждые X мин во время          │
│    └─ periodic_after   - Каждые X мин после             │
│                                                          │
│ 3. 📅 КАЛЕНДАРНЫЕ (Calendar)                            │
│    ├─ daily_at         - Каждый день в X:XX             │
│    ├─ weekly_on        - Каждую неделю в дни [1,3,5]    │
│    └─ monthly_on       - Каждый месяц 15-го числа       │
│                                                          │
│ 4. 🎯 УСЛОВНЫЕ (Conditional)                            │
│    ├─ if_not_done      - Если задача не выполнена       │
│    ├─ escalating       - Нарастающие (1ч, 30м, 10м)     │
│    └─ smart_adaptive   - Умные (на основе истории)      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### Уровень 2: Правила (Rules)

Правило = Тип + Параметры + Условия

```json
{
  "id": 1,
  "rule_type": "periodic_before",
  "enabled": true,
  "parameters": {
    "interval_minutes": 30,
    "start_from": "16:00",      // Абсолютное время ИЛИ
    "start_from_offset": 240,   // Минуты до начала
    "stop_at": 30,              // Минуты до начала
    "days_filter": [1, 3, 5]    // Только в Пн, Ср, Пт
  },
  "conditions": {
    "only_if_not_completed": true,
    "only_between_hours": [8, 22]  // Только с 8:00 до 22:00
  },
  "message_template": "Не забудь: {{task_title}} через {{time_left}}"
}
```

### Уровень 3: Шаблоны (Templates)

Наборы правил для быстрого применения:

```
┌─────────────────────────────────────────────────────────┐
│ ГОТОВЫЕ ШАБЛОНЫ НАПОМИНАНИЙ                             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 📌 Простые задачи:                                      │
│   • За день до дедлайна (1440 мин)                      │
│   • За час до дедлайна (60 мин)                         │
│   • В момент дедлайна (0 мин)                           │
│                                                          │
│ 🏃 Регулярные события:                                  │
│   • Напоминание утром в день события (09:00)            │
│   • За час до начала (60 мин)                           │
│   • В момент начала (0 мин)                             │
│                                                          │
│ ⚽ Спортивные тренировки:                                │
│   • Периодические с 16:00 каждые 30 мин                 │
│   • До 30 мин до начала                                 │
│   • За 20 мин до конца                                  │
│                                                          │
│ 💼 Важные встречи:                                      │
│   • За 3 дня (напоминание подготовиться)                │
│   • Утром в день встречи (09:00)                        │
│   • За 2 часа (120 мин)                                 │
│   • За 30 мин (проверить место)                         │
│   • За 10 мин (выходить)                                │
│   • В момент начала                                     │
│                                                          │
│ 📞 Звонки/Созвоны:                                      │
│   • За 15 мин (подготовить документы)                   │
│   • За 2 мин (открыть Zoom)                             │
│   • В момент начала                                     │
│                                                          │
│ 💊 Прием лекарств:                                      │
│   • Ежедневно в 09:00, 14:00, 21:00                     │
│   • Повтор через 10 мин если не подтвердил              │
│                                                          │
│ 🎂 Дни рождения:                                        │
│   • За неделю (купить подарок)                          │
│   • За 3 дня (оформить)                                 │
│   • За день (поздравить)                                │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🎨 UI/UX Дизайн

### Режим 1: Быстрый (Quick Mode)

Выбор из готовых шаблонов:

```
┌───────────────────────────────────────────────────────────┐
│ ⚡ Быстрая настройка напоминаний                          │
├───────────────────────────────────────────────────────────┤
│                                                            │
│ Выберите шаблон:                                          │
│                                                            │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│ │  📌 Простая  │ │ 🏃 Событие   │ │ ⚽ Тренировка │      │
│ │   задача     │ │              │ │              │      │
│ │              │ │              │ │              │      │
│ │ • За 1 день  │ │ • Утром      │ │ • С 16:00    │      │
│ │ • За 1 час   │ │ • За 1 час   │ │ • Каждые 30м │      │
│ │              │ │ • Вовремя    │ │ • До конца   │      │
│ └──────────────┘ └──────────────┘ └──────────────┘      │
│                                                            │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│ │ 💼 Встреча   │ │ 💊 Лекарства │ │ ➕ Создать   │      │
│ │              │ │              │ │  свой шаблон │      │
│ └──────────────┘ └──────────────┘ └──────────────┘      │
│                                                            │
│ [Применить шаблон]  [Расширенные настройки →]            │
└───────────────────────────────────────────────────────────┘
```

### Режим 2: Расширенный (Advanced Mode)

Визуальный конструктор правил:

```
┌───────────────────────────────────────────────────────────┐
│ 🎯 Расширенная настройка напоминаний                      │
├───────────────────────────────────────────────────────────┤
│                                                            │
│ Временная линия:                                          │
│                                                            │
│ ├─────────┼─────────┼─────────┼────▶START◀────┼─────────┤│
│  -3 дня   -1 день   -1 час   -30 мин           +20 мин   │
│                                                            │
│ Правила напоминаний:                                      │
│                                                            │
│ ┌────────────────────────────────────────────────────┐   │
│ │ 1. 🔁 Периодически до начала              [🔧][❌] │   │
│ │    ╔═══════════════════════════════════════════╗   │   │
│ │    ║ Каждые: [30▼] минут                       ║   │   │
│ │    ║ С:      [16:00] (фиксированное время)     ║   │   │
│ │    ║ До:     [30▼] минут до начала             ║   │   │
│ │    ║ Дни:    ☑Пн ☐Вт ☑Ср ☐Чт ☑Пт ☐Сб ☐Вс     ║   │   │
│ │    ╚═══════════════════════════════════════════╝   │   │
│ │    📊 Предпросмотр: 9 напоминаний в Пн:           │   │
│ │    16:00, 16:30, 17:00, 17:30, 18:00, 18:30...    │   │
│ └────────────────────────────────────────────────────┘   │
│                                                            │
│ ┌────────────────────────────────────────────────────┐   │
│ │ 2. ⏰ За X до конца                       [🔧][❌] │   │
│ │    ╔═══════════════════════════════════════════╗   │   │
│ │    ║ За:     [20▼] минут до конца              ║   │   │
│ │    ╚═══════════════════════════════════════════╝   │   │
│ └────────────────────────────────────────────────────┘   │
│                                                            │
│ [➕ Добавить правило ▼]                                   │
│   ├─ ⏰ Одиночное напоминание                             │
│   ├─ 🔁 Периодическое напоминание                        │
│   ├─ 📅 Календарное напоминание                          │
│   └─ 🎯 Условное напоминание                             │
│                                                            │
│ ┌────────────────────────────────────────────────────┐   │
│ │ 💾 Сохранить как шаблон:                          │   │
│ │ Название: [Футбол - тренировки сына         ]     │   │
│ │ [✓] Сделать доступным для других задач            │   │
│ └────────────────────────────────────────────────────┘   │
│                                                            │
│ [💾 Сохранить]  [👁️ Предпросмотр]  [❌ Отмена]          │
└───────────────────────────────────────────────────────────┘
```

### Режим 3: Предпросмотр (Preview Mode)

Календарь сгенерированных напоминаний:

```
┌───────────────────────────────────────────────────────────┐
│ 👁️ Предпросмотр напоминаний на следующие 7 дней          │
├───────────────────────────────────────────────────────────┤
│                                                            │
│ Понедельник, 14 октября 2025:                             │
│   📍 16:00 - Футбол - сын (через 4 часа)                  │
│   📍 16:30 - Футбол - сын (через 3.5 часа)                │
│   📍 17:00 - Футбол - сын (через 3 часа)                  │
│   📍 17:30 - Футбол - сын (через 2.5 часа)                │
│   📍 18:00 - Футбол - сын (через 2 часа)                  │
│   📍 18:30 - Футбол - сын (через 1.5 часа)                │
│   📍 19:00 - Футбол - сын (через 1 час)                   │
│   📍 19:30 - Футбол - сын (через 30 минут)                │
│   📍 20:40 - Футбол - сын (заканчивается через 20 минут)  │
│                                                            │
│ Среда, 16 октября 2025:                                   │
│   📍 16:00 - Футбол - сын (через 4 часа)                  │
│   📍 16:30 - Футбол - сын (через 3.5 часа)                │
│   ... (аналогично)                                         │
│                                                            │
│ Всего: 47 напоминаний на следующие 14 дней                │
│                                                            │
│ [⬅️ Назад]  [✏️ Редактировать]  [✅ Применить]            │
└───────────────────────────────────────────────────────────┘
```

---

## 🔧 Расширенные возможности

### 1. Умные напоминания (Smart Reminders)

На основе истории поведения пользователя:

```python
# Анализ истории
class SmartReminderAnalyzer:
    def analyze_user_behavior(user_id):
        """
        Анализирует когда пользователь обычно выполняет задачи
        и предлагает оптимальное время напоминаний
        """
        # Пример: пользователь обычно выполняет задачи 
        # в 9:00, 14:00, 20:00
        return {
            "preferred_times": ["09:00", "14:00", "20:00"],
            "avg_response_time": 15,  # минут
            "best_reminder_interval": 30  # минут
        }
```

### 2. Нарастающие напоминания (Escalating)

Увеличение частоты при приближении дедлайна:

```
За 3 дня:  1 напоминание
За 1 день:  2 напоминания (утро, вечер)
За 6 часов: каждые 2 часа
За 1 час:   каждые 15 минут
За 10 мин:  каждые 2 минуты
```

### 3. Контекстные напоминания (Context-Aware)

С учетом местоположения, погоды, календаря:

```json
{
  "rule_type": "context_aware",
  "parameters": {
    "location": "near_home",        // При приближении к дому
    "weather": "rain",               // Если дождь
    "calendar": "free_slot_before"   // Перед свободным слотом
  }
}
```

### 4. Групповые напоминания (Batch)

Сгруппировать несколько задач:

```
08:00 - Сводка на сегодня:
  • Футбол - сын (20:00)
  • Купить молоко
  • Позвонить врачу
```

---

## 📐 Структура БД (расширенная)

### Таблица: reminder_rule_templates

Готовые шаблоны правил:

```sql
CREATE TABLE reminder_rule_templates (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    category VARCHAR(50),  -- 'sport', 'work', 'health', 'personal'
    icon VARCHAR(20),      -- emoji или класс иконки
    
    -- JSON с массивом правил
    rules_json TEXT NOT NULL,
    
    -- Метаданные
    is_system BOOLEAN DEFAULT FALSE,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMP,
    created_by INTEGER
);
```

### Таблица: reminder_rules (расширенная)

```sql
ALTER TABLE reminder_rules ADD COLUMN conditions_json TEXT;
ALTER TABLE reminder_rules ADD COLUMN message_template TEXT;
ALTER TABLE reminder_rules ADD COLUMN priority INTEGER DEFAULT 1;
```

---

## 🚀 План реализации

### Фаза 1: Базовая функциональность (Готово ✅)
- [x] 5 базовых типов правил
- [x] Генератор напоминаний
- [x] UI для создания/редактирования
- [x] Telegram уведомления

### Фаза 2: Шаблоны (В разработке 🔄)
- [ ] Библиотека готовых шаблонов
- [ ] Сохранение пользовательских шаблонов
- [ ] Режим "Быстрая настройка"
- [ ] Предпросмотр напоминаний

### Фаза 3: Расширенные правила (Планируется 📋)
- [ ] Условные напоминания
- [ ] Нарастающие напоминания
- [ ] Умные напоминания (ML)
- [ ] Контекстные напоминания

### Фаза 4: Аналитика (Будущее 🔮)
- [ ] Статистика эффективности напоминаний
- [ ] A/B тестирование разных стратегий
- [ ] Рекомендации по оптимизации
- [ ] Экспорт/импорт шаблонов

---

## 💡 Примеры сложных сценариев

### Сценарий 1: Подготовка к экзамену

```
За 30 дней: "Начни подготовку" (1 раз)
За 14 дней: "Половина времени прошла" (1 раз)
За 7 дней:  Каждый день в 20:00 "Повтори материал"
За 3 дня:   2 раза в день (10:00, 20:00)
За 1 день:  3 раза в день (09:00, 15:00, 21:00)
В день:     Каждые 2 часа "Скоро экзамен!"
```

### Сценарий 2: Прием лекарств

```
Ежедневно: 09:00, 14:00, 21:00
Если не подтвердил:
  +5 мин: "Не забудь принять лекарство"
  +10 мин: "ВАЖНО: Прими лекарство!"
  +15 мин: Звонок

Еженедельно в Пт: "Осталось X таблеток, купи новую упаковку"
```

### Сценарий 3: Важный проект

```
За 1 месяц: "Начни планирование"
За 2 недели: "Проверь ресурсы"
За 1 неделю: Ежедневно "Статус: {progress}%"
За 3 дня: Каждые 12 часов
За 1 день: Каждые 4 часа
В день: Каждый час
За 1 час: Каждые 15 минут
```

---

## 🎯 Ключевые преимущества системы

1. **Модульность**: Правила независимы и комбинируются
2. **Масштабируемость**: Легко добавить новые типы правил
3. **Гибкость**: Любой сценарий можно настроить
4. **Простота**: Готовые шаблоны для типовых задач
5. **Умность**: Адаптация под поведение пользователя
6. **Визуальность**: Наглядный предпросмотр
7. **Переиспользование**: Шаблоны можно сохранять

---

## 📱 Мобильная версия

Упрощенный UI для мобильных устройств:

```
┌─────────────────────────┐
│ Напоминания             │
├─────────────────────────┤
│                         │
│ [Быстро] [Расширенно]   │
│                         │
│ Шаблон:                 │
│ [Простая задача    ▼]   │
│                         │
│ ✓ За 1 день             │
│ ✓ За 1 час              │
│                         │
│ [+ Добавить правило]    │
│                         │
│ [Сохранить]             │
└─────────────────────────┘
```

---

**Итого**: Гибкая, мощная и интуитивная система напоминаний, которая растет вместе с потребностями пользователя! 🚀

