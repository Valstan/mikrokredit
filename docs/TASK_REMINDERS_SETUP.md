# üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥–ª—è –∑–∞–¥–∞—á

## üìñ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥–ª—è –∑–∞–¥–∞—á —Å –≥–∏–±–∫–∏–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **ReminderGenerator** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–∑ –ø—Ä–∞–≤–∏–ª
2. **TelegramNotifier** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
3. **Cron –∑–∞–¥–∞—á–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

```
http://–≤–∞—à-–¥–æ–º–µ–Ω/tasks/new
```

–í—ã–±–µ—Ä–∏—Ç–µ:
- **–¢–∏–ø**: –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –°—Ä–µ–¥–∞, –ü—è—Ç–Ω–∏—Ü–∞ —Å 20:00 –¥–æ 21:00
- **–ü—Ä–∞–≤–∏–ª–∞**:
  - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥–æ –Ω–∞—á–∞–ª–∞: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω —Å 16:00 –¥–æ 30 –º–∏–Ω –¥–æ –Ω–∞—á–∞–ª–∞
  - –ó–∞ 20 –º–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –∑–∞–¥–∞—á–∏

```bash
cd /home/valstan/mikrokredit
./scripts/setup_all_cron.sh
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: **–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É**
- ‚úÖ –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è: **–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00**

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
python3 scripts/send_task_reminders.py

# –¢–µ—Å—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
python3 scripts/regenerate_reminders.py
```

---

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ UI `/tasks/new`:
- –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–¥–Ω–∏ –Ω–µ–¥–µ–ª–∏, –≤—Ä–µ–º—è)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:
```python
regenerate_task_reminders(task_id)
```
- –ß–∏—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `reminder_rules`
- –ß–∏—Ç–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–∑ `task_schedules`
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `task_reminders` –Ω–∞ 14 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥

### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∫–∞
–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `send_task_reminders.py`:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `task_reminders` –≥–¥–µ `sent=0` –∏ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram —á–µ—Ä–µ–∑ `telegram_notifier`
- –ü–æ–º–µ—á–∞–µ—Ç –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ (`sent=1`)

### –®–∞–≥ 4: –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `regenerate_reminders.py`:
- –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 14 –¥–Ω–µ–π

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª

### 1. –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º

```json
{
  "task_type": "simple",
  "due_date": "2025-10-15 18:00",
  "reminder_rules": [
    {"rule_type": "before_start", "offset_minutes": 1440},  // –ó–∞ 1 –¥–µ–Ω—å
    {"rule_type": "before_start", "offset_minutes": 60}     // –ó–∞ 1 —á–∞—Å
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 2 –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- 14.10.2025 –≤ 18:00
- 15.10.2025 –≤ 17:00

---

### 2. –§—É—Ç–±–æ–ª (–∏–∑ –¢–ó)

```json
{
  "task_type": "recurring_event",
  "schedules": [
    {"day_of_week": 1, "start_time": "20:00", "end_time": "21:00"},
    {"day_of_week": 3, "start_time": "20:00", "end_time": "21:00"},
    {"day_of_week": 5, "start_time": "21:00", "end_time": "22:00"}
  ],
  "reminder_rules": [
    {
      "rule_type": "periodic_before",
      "interval_minutes": 30,
      "start_from": "16:00",
      "stop_at": "30"
    },
    {
      "rule_type": "before_end",
      "offset_minutes": 20
    }
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞**:
- 16:00, 16:30, 17:00, 17:30, 18:00, 18:30, 19:00, 19:30 (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω)
- 20:40 (–∑–∞ 20 –º–∏–Ω –¥–æ –∫–æ–Ω—Ü–∞)

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø—è—Ç–Ω–∏—Ü—ã**:
- 16:00, 16:30, 17:00, 17:30, 18:00, 18:30, 19:00, 19:30, 20:00, 20:30
- 21:40 (–∑–∞ 20 –º–∏–Ω –¥–æ –∫–æ–Ω—Ü–∞)

---

### 3. –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—á—Ç—ã

```json
{
  "task_type": "recurring_event",
  "schedules": [
    {"day_of_week": 1, "start_time": "09:00"},
    {"day_of_week": 2, "start_time": "09:00"},
    {"day_of_week": 3, "start_time": "09:00"},
    {"day_of_week": 4, "start_time": "09:00"},
    {"day_of_week": 5, "start_time": "09:00"}
  ],
  "reminder_rules": [
    {"rule_type": "before_start", "offset_minutes": 0}  // –í –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞
  ]
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å –≤ 09:00

---

## üõ†Ô∏è API

### Python API

```python
from app.reminder_generator import regenerate_task_reminders

# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
count = regenerate_task_reminders(task_id)
print(f"–°–æ–∑–¥–∞–Ω–æ {count} –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π")
```

### Telegram API

```python
from app.telegram_notifier import send_task_reminder_notification

success = send_task_reminder_notification(
    task_title="–§—É—Ç–±–æ–ª - —Å—ã–Ω",
    task_id=123,
    reminder_type="before_start"
)
```

---

## üìù –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
tail -f logs/reminders_send.log

# –õ–æ–≥–∏ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
tail -f logs/reminders_regenerate.log

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f logs/error.log
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `.env`:
```
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è cron

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `scripts/setup_all_cron.sh` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞.

–ü—Ä–∏–º–µ—Ä—ã:
```bash
# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * ...

# –ö–∞–∂–¥—ã–π —á–∞—Å
0 * * * * ...

# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00
0 9 * * * ...
```

---

## ‚ùì FAQ

**Q: –ö–∞–∫ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –≤—Ä–µ–º—è?**  
A: –í UI –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ –¥–∞—Ç—ã" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É.

**Q: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç?**  
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. `crontab -l` - –µ—Å—Ç—å –ª–∏ –∑–∞–¥–∞—á–∏
2. `logs/reminders_send.log` - –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
3. Telegram credentials –≤ `.env`

**Q: –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è?**  
A: 
```sql
DELETE FROM task_reminders WHERE sent = 0 AND reminder_time < datetime('now');
```

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (14 –¥–Ω–µ–π)?**  
A: –í `regenerate_reminders.py` –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `days_ahead`.

---

## üéì –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
User creates task ‚Üí ReminderGenerator
                    ‚Üì
                task_reminders (14 days ahead)
                    ‚Üì
         Cron (every minute) ‚Üí send_task_reminders.py
                    ‚Üì
              TelegramNotifier ‚Üí User's phone üì±
                    ‚Üì
           task_reminders.sent = 1
```

---

## üìÖ –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö/–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö
- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–í–µ—Ä—Å–∏—è**: 1.0

