# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ "–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞"

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ó–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞** (MikroKredit Manager) - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–µ–±-—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ–∑–∞–π–º–∞–º–∏ –∏ –ª–∏—á–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Telegram –±–æ—Ç–∞.

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 09.10.2025  
**–°—Ç–µ–∫:** Python 3.12, Flask, PostgreSQL, Telegram Bot API

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/home/valstan/mikrokredit/
‚îÇ
‚îú‚îÄ‚îÄ app/                          # –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                   # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ db_sa.py                  # SQLAlchemy engine –∏ —Å–µ—Å—Å–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ models_sa.py              # ORM –º–æ–¥–µ–ª–∏ (9 —Ç–∞–±–ª–∏—Ü)
‚îÇ   ‚îú‚îÄ‚îÄ integration.py            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Redis, API)
‚îÇ   ‚îî‚îÄ‚îÄ ui/                       # –°—Ç–∞—Ä—ã–π desktop UI (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îÇ
‚îú‚îÄ‚îÄ web/                          # Flask –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py               # –°–æ–∑–¥–∞–Ω–∏–µ Flask app
‚îÇ   ‚îú‚îÄ‚îÄ views.py                  # –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∑–∞–π–º–æ–≤ –∏ dashboard
‚îÇ   ‚îú‚îÄ‚îÄ auth_views.py             # –ú–∞—Ä—à—Ä—É—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ tasks_views.py            # –ú–∞—Ä—à—Ä—É—Ç—ã –æ—Ä–≥–∞–Ω–∞–π–∑–µ—Ä–∞ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ templates/                # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ       ‚îú‚îÄ‚îÄ base.html             # –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å navbar
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.html        # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ       ‚îú‚îÄ‚îÄ index.html            # –°–ø–∏—Å–æ–∫ –∑–∞–π–º–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ loan_edit.html        # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–π–º–∞
‚îÇ       ‚îú‚îÄ‚îÄ auth/                 # –®–∞–±–ª–æ–Ω—ã –≤—Ö–æ–¥–∞
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ login.html
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ blocked.html
‚îÇ       ‚îî‚îÄ‚îÄ tasks/                # –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á
‚îÇ           ‚îú‚îÄ‚îÄ index.html
‚îÇ           ‚îú‚îÄ‚îÄ edit.html
‚îÇ           ‚îî‚îÄ‚îÄ categories.html
‚îÇ
‚îú‚îÄ‚îÄ logs/                         # –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ error.log                 # –û—à–∏–±–∫–∏ Flask
‚îÇ   ‚îú‚îÄ‚îÄ access.log                # –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ backup.log                # –ë—ç–∫–∞–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ telegram.log              # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–π–º–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_tasks.log        # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_repeat.log       # –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ telegram_bot_fresh.log    # Telegram –±–æ—Ç-—Å–µ—Ä–≤–µ—Ä
‚îÇ
‚îú‚îÄ‚îÄ backups/                      # –õ–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î
‚îÇ
‚îú‚îÄ‚îÄ scripts/                      # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ Telegram –±–æ—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã:
‚îÇ   ‚îú‚îÄ‚îÄ telegram_notifier.py      # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ä—è—â–∏—Ö –∑–∞–π–º–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot_tasks.py     # –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–¥–∞—á–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot_server.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫ (—Ñ–æ–Ω–æ–≤—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ telegram_repeat_reminders.py  # –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ init_reminder_templates.py    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚îÇ   ‚îú‚îÄ‚îÄ start_service.sh          # –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ stop_service.sh           # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ start_telegram_bot.sh     # –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ backup_to_yandex.sh       # –ë—ç–∫–∞–ø –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ download_from_yandex.sh   # –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø
‚îÇ   ‚îî‚îÄ‚îÄ fix_sequences.sh          # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ sequences –ë–î
‚îÇ
‚îú‚îÄ‚îÄ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
‚îÇ   ‚îú‚îÄ‚îÄ gunicorn.conf.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Gunicorn
‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îÇ   ‚îú‚îÄ‚îÄ mikrokredit.service       # Systemd service
‚îÇ   ‚îî‚îÄ‚îÄ mikrokredit.conf          # Nginx site config
‚îÇ
‚îú‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: (25 MD —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ START_HERE_v2.md          # –ù–ê–ß–ê–¢–¨ –û–¢–°–Æ–î–ê ‚≠ê
‚îÇ   ‚îú‚îÄ‚îÄ COMPLETE_GUIDE_2025-10-09.md
‚îÇ   ‚îú‚îÄ‚îÄ PROJECT_ARCHITECTURE.md   # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ   ‚îî‚îÄ‚îÄ ...–æ—Å—Ç–∞–ª—å–Ω—ã–µ
‚îÇ
‚îî‚îÄ‚îÄ –ü—Ä–æ—á–µ–µ:
    ‚îú‚îÄ‚îÄ requirements.txt          # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    ‚îú‚îÄ‚îÄ .gitignore                # Git ignore –ø—Ä–∞–≤–∏–ª–∞
    ‚îî‚îÄ‚îÄ README.md                 # –û—Å–Ω–æ–≤–Ω–æ–π README

```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL 18.0)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
Host:     localhost:5432
Database: mikrokredit
User:     mikrokredit_user
Password: mikrokredit_pass_2024
```

### –¢–∞–±–ª–∏—Ü—ã:

#### –ó–∞–π–º—ã (4 —Ç–∞–±–ª–∏—Ü—ã):
1. **loans** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–π–º–æ–≤
   - id, org_name, website, loan_date, due_date
   - amount_borrowed, amount_due, is_paid
   - risky_org, notes, payment_methods

2. **installments** - –ø–ª–∞—Ç–µ–∂–∏ –ø–æ —Ä–∞—Å—Å—Ä–æ—á–∫–µ
   - id, loan_id, due_date, amount
   - paid, paid_date

#### –ó–∞–¥–∞—á–∏ (5 —Ç–∞–±–ª–∏—Ü):
3. **tasks** - –∑–∞–¥–∞—á–∏
   - id, title, description
   - status (0/1), importance (1/2/3)
   - due_date, category_id
   - is_recurring, recurrence_rule

4. **task_categories** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–¥–∞—á
   - id, name, color, icon

5. **subtasks** - –ø–æ–¥–∑–∞–¥–∞—á–∏ (—á–µ–∫–ª–∏—Å—Ç—ã)
   - id, task_id, title, completed, order

6. **task_reminders** - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
   - id, task_id, reminder_time
   - sent, sent_at, telegram_message_id
   - acknowledged, acknowledged_at

7. **reminder_templates** - —à–∞–±–ª–æ–Ω—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
   - id, name, description, rules (JSON)

---

## üîÑ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ó–∞–π–º—ã (–ú–∏–∫—Ä–æ–ö—Ä–µ–¥–∏—Ç)

#### –†–∞—Å—á—ë—Ç –¥–æ–ª–≥–∞:
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–π–º–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è **installments** (–ø–ª–∞—Ç–µ–∂–∏)
2. –ï—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–∏ ‚Üí —Å—É–º–º–∞ = SUM(unpaid installments)
3. –ï—Å–ª–∏ –Ω–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π ‚Üí —Å—É–º–º–∞ = amount_due
4. **–û–ø–ª–∞—á–µ–Ω** = –≤—Å–µ installments.paid = 1

#### –ö—Ä–∏—Ç–µ—Ä–∏–π "–≥–æ—Ä—è—â–∏–π":
- –ë–µ—Ä—ë—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–π –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π installment
- –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è days_left = (due_date - today).days
- **–ì–æ—Ä—è—â–∏–π** –µ—Å–ª–∏ days_left < 5

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–í—Å–µ–≥–æ:** COUNT(loans)
- **–ì–æ—Ä—è—â–∏–µ:** COUNT –≥–¥–µ days_left < 5
- **–î–æ–ª–≥:** SUM(unpaid_total) –ø–æ –≤—Å–µ–º –∑–∞–π–º–∞–º

### –ó–∞–¥–∞—á–∏ (–û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä)

#### –í–∞–∂–Ω–æ—Å—Ç—å (3 —É—Ä–æ–≤–Ω—è):
- **1** = üî¥ –í–∞–∂–Ω–∞—è (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ, —Å –¥–µ–¥–ª–∞–π–Ω–æ–º)
- **2** = üü° –ù—É–∂–Ω–∞—è (–ø–ª–∞–Ω–æ–≤—ã–µ)
- **3** = ‚ö™ –•–æ—Ç–µ–ª–æ—Å—å –±—ã (–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ)

#### –°—Ç–∞—Ç—É—Å—ã:
- **0** = –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- **1** = –í—ã–ø–æ–ª–Ω–µ–Ω–æ

#### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:

**–®–∞–±–ª–æ–Ω—ã (5 –≥–æ—Ç–æ–≤—ã—Ö):**
1. –ó–∞ 1 –¥–µ–Ω—å –¥–æ —Å—Ä–æ–∫–∞
2. –ó–∞ –¥–µ–Ω—å –∏ –≤ –¥–µ–Ω—å
3. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ (3 –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
4. –û—á–µ–Ω—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ (5 –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π)
5. –¢–æ–ª—å–∫–æ –≤ –¥–µ–Ω—å –¥–µ–¥–ª–∞–π–Ω–∞

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—ã–µ –¥–∞—Ç—ã/–≤—Ä–µ–º—è
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ task_reminders

**–õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:**
1. Cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `telegram_bot_tasks.py` –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
2. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è task_reminders –≥–¥–µ:
   - sent = 0
   - reminder_time <= NOW()
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è telegram_message_id
5. –ü–æ–º–µ—á–∞–µ—Ç—Å—è sent = 1

**–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:**
1. Cron –∑–∞–ø—É—Å–∫–∞–µ—Ç `telegram_repeat_reminders.py` –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
2. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è task_reminders –≥–¥–µ:
   - sent = 1
   - acknowledged = 0
   - sent_at < NOW() - 15 –º–∏–Ω—É—Ç
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
4. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è sent_at

**–†–∞–±–æ—á–∏–µ —á–∞—Å—ã:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Å 7:00 –¥–æ 22:00 MSK
- –ù–æ—á—å—é –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –°—Ö–µ–º–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/login`
2. –í–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å (max 3 –ø–æ–ø—ã—Ç–∫–∏)
3. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Üí session['authenticated'] = True
4. Cookie –Ω–∞ 30 –¥–Ω–µ–π

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:
- –ü–æ IP –∞–¥—Ä–µ—Å—É (—É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è X-Forwarded-For)
- –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Üí 5 –º–∏–Ω—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –°—Ç–∞—Ä—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç

### –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤:
```python
@login_required  # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –Ω–∞ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö –∫—Ä–æ–º–µ healthz –∏ auth
```

---

## üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ë–æ—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã:

#### 1. telegram_notifier.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ä—è—â–∏—Ö –∑–∞–π–º–∞—Ö  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** 10:00 –∏ 20:00 MSK (cron)  
**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–π–º—ã —Å days_left <= 2
- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram (–±–µ–∑ –∫–Ω–æ–ø–æ–∫)

#### 2. telegram_bot_tasks.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–¥–∞—á–∞—Ö  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (cron)  
**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç task_reminders (sent=0, time<=NOW)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å inline –∫–Ω–æ–ø–∫–∞–º–∏
- –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22)

#### 3. telegram_repeat_reminders.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è  
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (cron)  
**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ (acknowledged=0)
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ > 15 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã

#### 4. telegram_bot_server.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫  
**–†–µ–∂–∏–º:** –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (—Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å)  
**–õ–æ–≥–∏–∫–∞:**
- Polling Telegram API
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç callback_query
- –ö–Ω–æ–ø–∫–∞ "–í—ã–ø–æ–ª–Ω–∏–ª" ‚Üí task.status = 1
- –ö–Ω–æ–ø–∫–∞ "–û—Ç–ª–æ–∂–∏—Ç—å" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### Inline –∫–Ω–æ–ø–∫–∏:

```python
callback_data="task_complete_{task_id}_{reminder_id}"  # –í—ã–ø–æ–ª–Ω–∏–ª
callback_data="task_postpone_{task_id}_{reminder_id}"  # –û—Ç–ª–æ–∂–∏—Ç—å
```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Cron)

```bash
# –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö
* * * * *       telegram_bot_tasks.py

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
*/15 * * * *    telegram_repeat_reminders.py

# –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã
0 10,20 * * *   telegram_notifier.py

# –ë—ç–∫–∞–ø –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫
0 2 * * *       backup_to_yandex.sh
```

---

## üåê –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Flask)

### Blueprints:

#### 1. auth (auth_views.py)
- `/auth/login` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- `/auth/logout` - –≤—ã—Ö–æ–¥

#### 2. views (views.py)
- `/` - Dashboard
- `/loans` - —Å–ø–∏—Å–æ–∫ –∑–∞–π–º–æ–≤
- `/loan/new` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–π–º–∞
- `/loan/<id>` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `/loan/<id>/installments/add` - –¥–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂
- `/loan/<id>/delete` - —É–¥–∞–ª–∏—Ç—å

#### 3. tasks (tasks_views.py)
- `/tasks/` - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
- `/tasks/new` - —Å–æ–∑–¥–∞–Ω–∏–µ
- `/tasks/<id>` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `/tasks/<id>/complete` - –ø–æ–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
- `/tasks/<id>/delete` - —É–¥–∞–ª–∏—Ç—å
- `/tasks/categories` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### Middleware:
- ProxyFix - –¥–ª—è —Ä–∞–±–æ—Ç—ã –∑–∞ Nginx
- Session - 30 –¥–Ω–µ–π cookie

---

## üöÄ Deployment

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Internet
    ‚Üì
Nginx :80 (reverse proxy)
    ‚Üì
Gunicorn :8002 (4 workers)
    ‚Üì
Flask Application
    ‚Üì
PostgreSQL :5432
    ‚Üì
Redis :6379 (cache)
```

### –ü—Ä–æ—Ü–µ—Å—Å—ã:

1. **Gunicorn** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
   - 1 master + 3 workers
   - –ü–æ—Ä—Ç: 8002
   - Config: gunicorn.conf.py

2. **Telegram Bot Server** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback
   - –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - Polling API
   - –õ–æ–≥–∏: logs/telegram_bot_fresh.log

3. **PostgreSQL** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
   - Version: 18.0
   - Pool: 10 + 20 overflow
   - Pre-ping: enabled

4. **Nginx** - reverse proxy
   - Version: 1.28.0
   - SSL: ready (–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
   - Config: /etc/nginx/conf.d/mikrokredit.conf

5. **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Version: 7.4.1
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è cache_manager

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
MIKROKREDIT_DATABASE_URL=postgresql://mikrokredit_user:mikrokredit_pass_2024@localhost:5432/mikrokredit
```

### –°–µ–∫—Ä–µ—Ç—ã:
- **Auth password:** Nitro@1941
- **Telegram token:** 489021673:AAH7QDGmqzOMgT0W_wINvzWC1ihfljuFAKI
- **Telegram chat_id:** 352096813
- **Yandex token:** y0__xDR8Z0KGNuWAyCFzMykFJz31O8WoqV9ONfVuMNLNIyjYsZK

### Flask config:
```python
SECRET_KEY = "mikrokredit_secret_key_2025_secure_random_string"
PERMANENT_SESSION_LIFETIME = 30 days
```

---

## üìä –í–∞–∂–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

### 1. –†–∞—Å—á—ë—Ç –¥–æ–ª–≥–∞ –ø–æ –∑–∞–π–º—É

```python
def get_loan_debt(loan_id):
    # –°—É–º–º–∞ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
    unpaid = SUM(installments.amount WHERE paid = 0)
    
    if unpaid > 0:
        return unpaid
    else:
        return loan.amount_due  # –ï—Å–ª–∏ —Ä–∞—Å—Å—Ä–æ—á–∫–∏ –Ω–µ—Ç
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ "–≥–æ—Ä—è—â–µ–≥–æ" –∑–∞–π–º–∞

```python
def is_urgent(loan):
    # –ë–ª–∏–∂–∞–π—à–∏–π –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂
    next_payment = installments.where(paid=0).order_by(due_date).first()
    
    if next_payment:
        days_left = (next_payment.due_date - today).days
        return days_left < 5
    
    return False
```

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–µ

```python
def send_task_reminder():
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤
    if not (7 <= hour < 22):
        return
    
    # 2. –ù–∞–π—Ç–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    reminders = TaskReminder.where(
        sent=0, 
        reminder_time <= NOW()
    )
    
    # 3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    for reminder in reminders:
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å –∫–Ω–æ–ø–∫–∞–º–∏
        keyboard = [
            ["‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª", "‚è∞ –û—Ç–ª–æ–∂–∏—Ç—å"]
        ]
        send_message(text, keyboard)
        
        # –ü–æ–º–µ—Ç–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º
        reminder.sent = 1
        reminder.sent_at = NOW()
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–í—ã–ø–æ–ª–Ω–∏–ª"

```python
def handle_callback(callback_query):
    task_id, reminder_id = parse_callback_data()
    
    # 1. –ü–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π
    task.status = 1
    task.completed_at = NOW()
    
    # 2. –û—Ç–º–µ—Ç–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ
    reminder.acknowledged = 1
    
    # 3. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±—É–¥—É—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏
    TaskReminder.where(task_id=task_id, sent=0).delete()
    
    # 4. –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
    edit_message("‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! üéâ")
```

---

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É
   ‚Üì
2. –í—ã–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
   ‚Üì
3. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ task_reminders
   ‚Üì
4. Cron (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
   ‚Üì
5. –ö–æ–≥–¥–∞ –≤—Ä–µ–º—è –Ω–∞—Å—Ç—É–ø–∞–µ—Ç ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–ø–æ–ª–Ω–∏–ª"
   ‚Üì
7. Callback ‚Üí task.status = 1
   ‚Üì
8. –ë—É–¥—É—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è
   ‚Üì
9. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è "–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!"
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ):

```
5. –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
   ‚Üì
6. –ù–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ 15 –º–∏–Ω—É—Ç
   ‚Üì
7. telegram_repeat_reminders.py –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
   ‚Üì
8. –°–Ω–æ–≤–∞ –Ω–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ 15 –º–∏–Ω—É—Ç
   ‚Üì
9. –ü–æ–≤—Ç–æ—Ä (–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –ø–æ–∫–∞ –Ω–µ –Ω–∞–∂–º—ë—Ç –∫–Ω–æ–ø–∫—É)
   ‚Üì
10. –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22)
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã:

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –ï–¥–∏–Ω—ã–π –ø–∞—Ä–æ–ª—å (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)
   - 3 –ø–æ–ø—ã—Ç–∫–∏ + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP
   - Session cookie (httponly)

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - Dedicated user (–Ω–µ postgres)
   - –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   - –°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å

3. **Telegram**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ chat_id
   - –¢–æ–∫–µ–Ω –Ω–µ –≤ git
   - –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ callback

4. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**
   - –ó–∞ Nginx proxy
   - Security headers
   - CSRF protection (Flask)

---

## üíæ –ë—ç–∫–∞–ø—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ:
- **–ö–æ–≥–¥–∞:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00 MSK
- **–ö—É–¥–∞:** –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫
- **–§–æ—Ä–º–∞—Ç:** SQL dump + gzip (~8 KB)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** 10 –∫–æ–ø–∏–π –Ω–∞ –Ø.–î–∏—Å–∫–µ, 3 –ª–æ–∫–∞–ª—å–Ω–æ
- **–°—Å—ã–ª–∫–∞:** https://yadi.sk/d/gVpI3Fst7J5EIw

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
./download_from_yandex.sh latest
gunzip mikrokredit_*.sql.gz
psql -U mikrokredit_user -d mikrokredit -h localhost < backup.sql
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```bash
# Health check
curl http://localhost/healthz
# {"status":"ok"}

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä
ps aux | grep gunicorn | grep mikrokredit

# Telegram –±–æ—Ç
ps aux | grep telegram_bot_server

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
psql -U mikrokredit_user -d mikrokredit -h localhost -c "SELECT COUNT(*) FROM tasks;"

# Cron
crontab -l
```

---

## üìù –ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `init_reminder_templates.py`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ SYSTEM_TEMPLATES
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `python3 init_reminder_templates.py`

### –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –±–æ—Ç–∞:

–í —Ñ–∞–π–ª–∞—Ö `telegram_*.py`:
```python
BOT_WORK_HOURS_START = 7  # –ù–∞—á–∞–ª–æ
BOT_WORK_HOURS_END = 22    # –ö–æ–Ω–µ—Ü
```

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ Telegram:

–í —Ñ–∞–π–ª–∞—Ö `telegram_*.py`:
```python
TELEGRAM_CHAT_ID = 352096813  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π ID
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Internal Server Error

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –õ–æ–≥–∏: `tail -50 logs/error.log`
2. PostgreSQL: `systemctl status postgresql`
3. Sequences: `./fix_sequences.sh`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–Ω–æ–ø–∫–∏ –≤ Telegram

**–ü—Ä–∏—á–∏–Ω—ã:**
- Telegram –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –°—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ (> 48 —á–∞—Å–æ–≤)
- –û—à–∏–±–∫–∞ –≤ callback

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å: `ps aux | grep telegram_bot_server`
2. –õ–æ–≥–∏: `tail -20 logs/telegram_bot_fresh.log`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫: `pkill -f telegram_bot_server && ./start_telegram_bot.sh`
4. –°–æ–∑–¥–∞–π—Ç–µ –ù–û–í–£–Æ –∑–∞–¥–∞—á—É –¥–ª—è —Å–≤–µ–∂–∏—Ö –∫–Ω–æ–ø–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Cron: `crontab -l`
2. –†–∞–±–æ—á–∏–µ —á–∞—Å—ã (7-22 MSK)
3. –õ–æ–≥–∏: `tail -20 logs/telegram_tasks.log`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é: `python3 telegram_bot_tasks.py`

---

## üìö –î–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å–µ—Å—Å–∏–π

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:

1. **PROJECT_ARCHITECTURE.md** - —ç—Ç–æ—Ç —Ñ–∞–π–ª
2. **app/models_sa.py** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
3. **web/views.py** - –ª–æ–≥–∏–∫–∞ –∑–∞–π–º–æ–≤
4. **web/tasks_views.py** - –ª–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á
5. **telegram_bot_server.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:

- –ó–∞–π–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **installments** –¥–ª—è —Ä–∞—Å—Å—Ä–æ—á–∫–∏
- –ó–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **task_reminders** –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- Telegram –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **2 —Ä–µ–∂–∏–º–∞—Ö**: cron (–æ—Ç–ø—Ä–∞–≤–∫–∞) + —Ñ–æ–Ω–æ–≤—ã–π (callback)
- SQLAlchemy –æ–±—ä–µ–∫—Ç—ã –Ω—É–∂–Ω–æ **–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –≤ dict** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ —à–∞–±–ª–æ–Ω—ã
- –ì–æ—Ä—è—â–∏–µ –∑–∞–π–º—ã = **days_left < 5** –æ—Ç –±–ª–∏–∂–∞–π—à–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

1. REST API –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. Webhook –¥–ª—è Telegram (–≤–º–µ—Å—Ç–æ polling)
3. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏ (recurrence_rule)
4. –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
6. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

---

**–î–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç—É–∞–ª–µ–Ω –Ω–∞:** 09.10.2025  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** Production Ready

**–ö–æ–Ω—Ç–∞–∫—Ç:** Telegram @valstanbot

